# Phase 5 Theory — Capstone Deep Dive (확장 버전)

Capstone은 핵심 유스케이스를 기능/품질/운영 관점으로 통합 구현하는 종합 검증 단계입니다.

---

## 학습 목표
- Phase 1~4에서 학습한 역량(기초/스프링/DDD/패턴)을 하나의 프로젝트로 통합한다.
- 기능 구현뿐 아니라 SLO, 관측성, 장애 복구, 의사결정 문서화까지 완성한다.
- 트레이드오프를 수치와 근거로 설명한다.

---

## 1) 프로젝트 시나리오
"StyleKorean 프로모션 시간대 주문 플로우 안정화"

### 비즈니스 목표
- 주문 성공률 향상
- 결제 실패 상태 불일치 0건
- 재고 음수/중복 차감 0건

### 기술 목표
- Port/Adapter 구조 유지
- 회귀를 막는 테스트 전략
- 로그/메트릭/알람 기반 운영 가시성

---

## 2) 필수 아키텍처 원칙
- 주문/결제/재고 경계 명확화
- 외부 연동은 Adapter로 캡슐화
- 이벤트 처리 멱등성(eventId) 보장
- 실패 시 재시도/보상/DLQ 기준 수치화

---

## 3) 운영 SLO/SLI 설계 예시

### SLO
- 주문 생성 성공률 >= 99.5%
- 주문 API p95 < 700ms, p99 < 1.2s
- 결제 실패 상태 불일치 0건

### SLI
- `order.create.success.rate`
- `payment.failure.recovery.time`
- `inventory.negative.count`
- `dlq.events.count`

---

## 4) 장애 시나리오 모델

### 핵심 장애
1. 결제 API timeout
2. 중복 이벤트 수신
3. DB 지연으로 주문 조회 성능 저하
4. partial failure(주문 생성 성공, 결제 실패)

### 대응 원칙
- 자동 대응 우선(재시도, 서킷브레이커, DLQ)
- 수동 대응(runbook) 기준 명확화

---

## 5) 의사결정 문서(ADR) 품질 기준
- 문제/제약/대안/결정/영향/후속 리스크를 포함
- "왜 이 선택을 했는가"를 운영 데이터와 연결
- 추후 폐기 가능성까지 기술

---

## 6) 발표 구성 프레임
1. 문제 정의
2. 아키텍처 선택 근거
3. 구현 핵심
4. 장애 대응
5. 지표 개선 결과
6. 한계와 다음 단계

---

## 7) Capstone 이후 확장 로드
- 실서비스 트래픽 기반 용량 계획
- 카나리/블루그린 점진 배포
- 장애 훈련(GameDay) 정례화
- 조직 단위 SLO 운영 거버넌스

---

## 8) 완료 체크리스트
- [ ] 기능/품질/운영/문서 4축을 모두 충족했다.
- [ ] 실패 시나리오를 자동/수동 대응으로 설계했다.
- [ ] 전/후 개선 효과를 수치로 제시했다.
- [ ] 트레이드오프를 ADR로 설명했다.
- [ ] 다음 단계 확장 주제를 본인 학습 계획으로 연결할 수 있다.
